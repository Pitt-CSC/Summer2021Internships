name: Sort Internships in README if Closed

on:
  push:
    branches:
      - master
    paths:
      - 'README.md'
  pull_request:
    branches:
      - master
    types: [closed]
  workflow_dispatch:

concurrency: 
  group: sort_internships
  cancel-in-progress: true

jobs:
  sort-internships:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.9'

      - name: Run sorting script
        run: python .github/scripts/sort_helper.py

      - name: Commit and push changes
        if: success()
        run: |
          git config --local user.email action@github.com
          git config --local user.name 'GitHub Action'
          git add README.md
          git diff-index --quiet HEAD || git commit -m "Sort internships in README"
          git push

      - name: Problem With Action
        if: failure()
        run: echo "There was an error with the sorting script."
